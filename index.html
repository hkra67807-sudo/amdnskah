let cart = {};

function addToCart(id, name, price) {
    if (cart[id]) {
        cart[id].qty++;
    } else {
        cart[id] = { name: name, price: price, qty: 1 };
    }
    updateUI();
}

function changeQty(id, delta) {
    if (cart[id]) {
        cart[id].qty += delta;
        if (cart[id].qty <= 0) delete cart[id];
        updateUI();
    }
}

function updateUI() {
    const list = document.getElementById('cart-items-list');
    list.innerHTML = "";
    let count = 0, total = 0;

    for (let id in cart) {
        count += cart[id].qty;
        let subtotal = cart[id].price * cart[id].qty;
        total += subtotal;
        
        list.innerHTML += `
            <div class="cart-item">
                <div style="flex:1"><strong>${cart[id].name}</strong><br><small>${cart[id].price.toLocaleString()} ÿØ.ÿπ</small></div>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="changeQty('${id}', -1)">-</button>
                    <span>${cart[id].qty}</span>
                    <button class="qty-btn" onclick="changeQty('${id}', 1)">+</button>
                </div>
                <div style="font-weight:bold; width:80px; text-align:left;">${subtotal.toLocaleString()}</div>
            </div>`;
    }

    if (count === 0) list.innerHTML = "<p style='text-align:center; color:#999;'>ÿ≥ŸÑÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ© ÿ≠ÿßŸÑŸäÿßŸã</p>";

    document.getElementById('cart-count').innerText = count;
    document.getElementById('total-price').innerText = total.toLocaleString();
}

function confirmOrder() {
    const phone = document.getElementById('cust-phone').value;
    const type = document.getElementById('delivery-type').value;
    const notes = document.getElementById('order-notes').value;
    const total = document.getElementById('total-price').innerText;

    if (Object.keys(cart).length === 0) { alert("ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©!"); return; }
    if (phone.length < 10) { alert("Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ÿµÿ≠Ÿäÿ≠"); return; }

    // ÿ™ÿ¨ŸáŸäÿ≤ ŸÜÿµ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÑŸÑÿ™ŸÑŸäÿ¨ÿ±ÿßŸÖ
    let orderDetails = "üõçÔ∏è *ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ ÿßŸÑŸÖŸàŸÇÿπ* \n\n";
    for (let id in cart) {
        orderDetails += `üîπ ${cart[id].name} (ÿßŸÑÿπÿØÿØ: ${cart[id].qty})\n`;
    }
    
    orderDetails += `\nüí∞ *ÿßŸÑŸÖÿ¨ŸÖŸàÿπ:* ${total} ÿØ.ÿπ`;
    orderDetails += `\nüì± *ÿ±ŸÇŸÖ ÿßŸÑÿπŸÖŸäŸÑ:* ${phone}`;
    orderDetails += `\nüöö *ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ:* ${type}`;
    if (notes) orderDetails += `\nüìù *ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™:* ${notes}`;

    // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿµ ÿ•ŸÑŸâ ÿ±ÿßÿ®ÿ∑ ÿ™ŸÑŸäÿ¨ÿ±ÿßŸÖ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ± ŸÑÿ≠ÿ≥ÿßÿ®ŸÉ po_pou
    const telegramUser = "po_pou"; 
    const encodedText = encodeURIComponent(orderDetails);
    const telegramUrl = `https://t.me/${telegramUser}?text=${encodedText}`;

    // ŸÅÿ™ÿ≠ ÿßŸÑÿ™ŸÑŸäÿ¨ÿ±ÿßŸÖ ŸÑÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®
    window.open(telegramUrl, '_blank');
    
    // ÿ™ÿµŸÅŸäÿ± ÿßŸÑÿ≥ŸÑÿ© ÿ®ÿπÿØ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®
    cart = {};
    updateUI();
    closeCart();
}

function openCart() { document.getElementById('cart-modal').style.display = 'flex'; }
function closeCart() { document.getElementById('cart-modal').style.display = 'none'; }
